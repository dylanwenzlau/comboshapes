(function(u,F,na){function N(a,b,c,d,f,e,l){a.save();a.fillStyle=e;a.font=d+"px "+f;a.textAlign="center";a.textBaseline="top";a.fillText(l,b,c-d/2);a.restore()}function z(a,b,c,d,f,e){d&&f&&((e=e||0)?(a.beginPath(),a.moveTo(b+e,c),a.lineTo(b+d-e,c),a.quadraticCurveTo(b+d,c,b+d,c+e),a.lineTo(b+d,c+f-e),a.quadraticCurveTo(b+d,c+f,b+d-e,c+f),a.lineTo(b+e,c+f),a.quadraticCurveTo(b,c+f,b,c+f-e),a.lineTo(b,c+e),a.quadraticCurveTo(b,c,b+e,c),a.closePath(),a.fill()):a.fillRect(b,c,d,f))}function O(a,b,c,
d){a.beginPath();a.arc(b,c,d,0,2*Math.PI);a.fill()}function ia(a,b,c){for(var d=a.length-1;0<=d;d--)if(a[d].j&&a[d].K(b,c))return a[d].click(b,c),!0;return!1}function Q(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a}function A(){this.j=!0;this.F=this.J=this.I=this.A=this.o=this.m=this.h=this.f=0;this.L=Date.now();this.C=0}function B(a,b){A.call(this,a);this.title=b;this.buttons=[];this.j=!1}function w(a,b,c){A.call(this,a);this.text=b;this.g=c;this.c="#fff";
this.a="#539"}function C(a){A.call(this,a);this.a=[];this.c={};this.b=[]}function G(a){A.call(this,a);this.b=3*Math.random()>>0;this.g=3*Math.random()>>0;this.a=3*Math.random()>>0;this.c=3*Math.random()>>0;this.s=0;this.i=!1}A.prototype={v:function(a,b,c,d){this.f=a;this.h=b;this.m=c;this.o=d},N:function(){var a=Date.now(),b=(a-this.C)/1E3;this.f+=this.I*b;this.h+=this.J*b;this.A+=this.F*b;this.C=a},M:function(a){return a.f+a.m>this.f&&a.h+a.o>this.h&&a.f<this.f+this.m&&a.h<this.h+this.o},K:function(a,
b){return a>=this.f&&a<this.f+this.m&&b>=this.h&&b<this.h+this.o},B:function(){this.j=!0},u:function(){this.j=!1},D:function(a){this.j=a!==na?!!a:!this.j}};Q(B,A);B.prototype.c=function(a){this.title=a};B.prototype.a=function(a){this.buttons.push(a);return a};B.prototype.b=function(a,b,c){if(this.j){this.v(0,0,b,c);a.fillStyle="rgba(0,0,0,0.8)";a.fillRect(0,0,b,c);var d=this.buttons.length+1,f=.8*b,e=Math.min(.1*c,.7*c/d),l=.3*e;d=d*e+(d-1)*l;b=b/2-f/2;N(a,b+f/2,c/2-d/2+e/2,.66*e,"helvetica,arial",
"#fff",this.title);for(var v=0;v<this.buttons.length;v++)this.buttons[v].b(a,b,c/2-d/2+(v+1)*(e+l),f,e)}};B.prototype.click=function(a,b){ia(this.buttons,a,b)};Q(w,A);w.prototype.i=function(){this.c="#fff";this.a="#988"};w.prototype.b=function(a,b,c,d,f){this.j&&(this.v(b,c,d,f),a.fillStyle=this.a,z(a,b,c,d,f,f/10),N(a,b+d/2,c+f/2,.4*f,"helvetica, arial",this.c,this.text))};w.prototype.click=function(){this.g(this)};Q(C,A);C.prototype.g=function(){for(var a=0;a<this.a.length;a++)this.a[a].G();this.b=
this.a;this.a=[];this.c={}};C.prototype.l=function(a){for(var b=[],c=0;16>c;c++)(!this.a[c]||a&&this.a[c].i)&&b.push(c);do for(a=0;a<b.length;a++){c=b[a];this.a[c]&&(this.c[this.a[c].H()]=!1);for(var d=!1;!d;){var f=new G(R),e=f.H();this.c[e]||(this.a[c]=f,d=this.c[e]=!0)}}while(!this.w())};C.prototype.w=function(){for(var a=0;a<this.a.length;a++)for(var b=0;b<this.a.length;b++)if(b!==a)for(var c=0;c<this.a.length;c++)if(c!==a&&c!==b&&this.i(this.a[a],this.a[b],this.a[c]))return!0;return!1};C.prototype.i=
function(a,b,c){return(a.b===b.b&&b.b===c.b||a.b!==b.b&&b.b!==c.b&&a.b!==c.b)&&(a.g===b.g&&b.g===c.g||a.g!==b.g&&b.g!==c.g&&a.g!==c.g)&&(a.a===b.a&&b.a===c.a||a.a!==b.a&&b.a!==c.a&&a.a!==c.a)&&(a.c===b.c&&b.c===c.c||a.c!==b.c&&b.c!==c.c&&a.c!==c.c)?!0:!1};C.prototype.s=function(a,b,c,d,f){this.v(b,c,d,f);a.fillStyle="#988";z(a,b,c,d,f,10);var e=d/20;O(a,b+e/2,c+e/2,e);O(a,b+d-e/2,c+e/2,e);O(a,b+e/2,c+f-e/2,e);O(a,b+d-e/2,c+f-e/2,e);if(d/f>X){var l=.2*f;e=l*X}else e=.2*d,l=e/X;var v=(d-4*e)/2/3;d=
(d-4*e-3*v)/2;f=(f-4*l-3*v)/2;for(var r=0;r<this.a.length;r++)this.a[r].v(b+d+r%4*(e+v),c+f+(r/4>>0)*(l+v),e,l),this.a[r].w(a);for(b=this.b.length-1;0<=b;b--)this.b[b].N(),this.b[b].w(a),this.M(this.b[b])||this.b.splice(b,1)};C.prototype.click=function(a,b){for(var c=!1,d=this.a.length-1;0<=d;d--)c=this.a[d].click(a,b)||c;a=[];for(b=0;b<this.a.length;b++)this.a[b].i&&a.push(this.a[b]);if(3===a.length)if(this.i(a[0],a[1],a[2]))if(R.b())this.g();else{for(c=0;c<a.length;c++)a[c].G();this.b=a;this.l(!0)}else{for(c=
0;c<a.length;c++)a[c].i=!1;R.f()}else c&&R.c(800,1)};Q(G,A);var ja=["#90f","#f70","#07f"];G.prototype.H=function(){return""+this.b+this.g+this.a+this.c};G.prototype.G=function(){this.C=Date.now();var a=15*this.m,b=Math.random()*Math.PI*2;this.I=Math.sin(b)*a;this.J=Math.cos(b)*a;this.F=6*Math.PI};G.prototype.w=function(a){var b=this.f,c=this.h,d=this.m,f=this.o,e=(Date.now()-this.L)%1E3;this.s=(500<e?1E3-e:e)/500;a.save();this.A&&(a.translate(b+d/2,c+f/2),a.rotate(this.A),b-=b+d/2,c-=c+f/2);e=d/20;
if(this.i){a.fillStyle="#ee0";var l=d/20;z(a,b-l,c-l,d+2*l,f+2*l,e);a.fillStyle="#fa0";l=this.s*d/20;z(a,b-l,c-l,d+2*l,f+2*l,e)}a.fillStyle="#fff";z(a,b,c,d,f,e);e=.22*f;b=b+d/2-e/2;0===this.c?this.l(a,b,c+.5*f-e/2,e,e):1===this.c?(this.l(a,b,c+.33*f-e/2,e,e),this.l(a,b,c+.66*f-e/2,e,e)):(this.l(a,b,c+.2*f-e/2,e,e),this.l(a,b,c+.5*f-e/2,e,e),this.l(a,b,c+.8*f-e/2,e,e));a.restore()};G.prototype.l=function(a,b,c,d,f){a.save();0===this.a?(a.fillStyle=ja[this.b],a.strokeStyle="none"):(1===this.a?(a.fillStyle=
"none",a.lineWidth=d/15):(a.fillStyle="none",a.lineWidth=d/4),a.strokeStyle=ja[this.b],b+=a.lineWidth/2,c+=a.lineWidth/2,d-=a.lineWidth,f-=a.lineWidth);if(0===this.g){var e=[[b,c],[b+.25*d,c],[b+.5*d,c],[b+.75*d,c],[b+d,c],[b+d,c+.25*f],[b+d,c+.5*f],[b+d,c+.75*f],[b+d,c+f],[b+.75*d,c+f],[b+.5*d,c+f],[b+.25*d,c+f],[b,c+f],[b,c+.75*f],[b,c+.5*f],[b,c+.25*f]];a.beginPath();c=.05*d;d=e[0][0];f=e[0][1];d=d+Math.random()*c*2-c;f=f+Math.random()*c*2-c;a.moveTo(d,f);for(d=1;d<e.length;d++)f=e[d][0],b=e[d][1],
f=f+Math.random()*c*2-c,b=b+Math.random()*c*2-c,a.lineTo(f,b);a.closePath();0===this.a?a.fill():a.stroke()}else 1===this.g?(e=d/2*(.9+.2*this.s),0===this.a?O(a,b+d/2,c+f/2,e):(d=b+d/2,c+=f/2,a.beginPath(),a.arc(d,c,e,0,2*Math.PI),a.stroke())):(a.translate(b+d/2,c+f/2),a.rotate(this.s*Math.PI/8-Math.PI/16),a.beginPath(),a.moveTo(0,-f/2),a.lineTo(d/2,f/2),a.lineTo(-d/2,f/2),a.closePath(),0===this.a?a.fill():a.stroke());a.restore()};G.prototype.click=function(a,b){return a>=this.f&&a<this.f+this.m&&
b>=this.h&&b<this.h+this.o?(this.i=!this.i,!0):!1};var X=5/7,R=new function(){function a(){I=0;Y.B();t.c("Game Paused");b()}function b(){I++;Z=Date.now();S=0;D=!1;T=U=0;aa=I;x.g();x.l()}function c(){if(P)P=!1,ba.text="Enable Music",y.gain.exponentialRampToValueAtTime(.2,m.currentTime),y.gain.exponentialRampToValueAtTime(1E-5,m.currentTime+.05);else if(P=!0,ba.text="Disable Music",y)y.gain.exponentialRampToValueAtTime(.2,m.currentTime+.05);else if(m){var g=m.createOscillator();y=m.createGain();g.connect(y);
y.connect(m.destination);g.type="triangle";y.gain.value=.01;g.start(0);y.gain.exponentialRampToValueAtTime(.2,m.currentTime+.05);for(var h=[200,250,300,400],k=[.5,.25],n=0,J;3600>n;){var ca=h[Math.random()*h.length>>0];if(ca!==J){J=ca;var oa=k[Math.random()*k.length>>0];g.frequency.setValueAtTime(ca,m.currentTime+n);n+=oa}}y.gain.setValueAtTime(.2,m.currentTime+n);y.gain.exponentialRampToValueAtTime(1E-5,m.currentTime+n+1)}}function d(g,h,k){function n(){f(g[J],h);J++;J<g.length&&setTimeout(n,1E3*
k)}var J=0;n()}function f(g,h){if(da&&m){h=h||.5;var k=m.createOscillator(),n=m.createGain();k.connect(n);n.connect(m.destination);k.frequency.value=g;k.type="triangle";k.start(0);n.gain.value=.01;n.gain.exponentialRampToValueAtTime(1,m.currentTime+.05);n.gain.exponentialRampToValueAtTime(1E-5,m.currentTime+h);k.stop(m.currentTime+2*h)}}function e(){D?(S+=Date.now()-ea,D=!1):(ea=Date.now(),D=!0)}function l(){V=Date.now();0===ka%10&&(fa=ha,ha=V);!D&&9E4<V-Z-S&&(e(),x.g(),K.B(),f(100,2));r.a();ka++;
u.requestAnimationFrame(l)}function v(){.1>Math.abs(u.innerWidth/u.innerHeight-.625)?(E=u.innerWidth,H=u.innerHeight):.625<u.innerWidth/u.innerHeight?(H=u.innerHeight,E=.625*H):(E=u.innerWidth,H=E/.625);p.style.width=E+"px";p.style.height=H+"px";p.width=E*L;p.height=H*L}var r=this,p=F.getElementById("game-canvas"),q=p.getContext("2d"),la=u.AudioContext||u.webkitAudioContext,E,H,L=1,m,y,x=new C(this),t=new B(this,""),K=new B(this,"You Lose."),M=new B(this,"You Won!"),ba,Y,ma,W,I=0,Z,ea,S=0,D=!1,ka=
0,V,ha,fa,U=0,T=0,aa=0,da=!0,P=!1;this.c=f;this.b=function(){U++;d([800,1200,1600],.5,.1);return U-T>=aa?(e(),ma.text="Start Level "+(I+1),M.B(),!0):!1};this.f=function(){T++;d([900,600,400],.5,.1)};this.a=function(){q.save();q.fillStyle="#539";q.fillRect(0,0,p.width,p.height);q.restore();var g=.1*p.height,h=p.width,k=p.height-g;.75<h/k?(k*=.94,h=.75*k):(h*=.94,k=h/.75);x.s(q,(p.width-h)/2,(p.height-k+g)/2,h,k);W.b(q,x.f,.25*g,.2*h,.5*g);q.fillStyle="#988";z(q,x.f+.3*h,.15*g,.4*h,.7*g,.07*g);N(q,
x.f+h/2,.33*g,.2*g,"arial","#fff","Level "+I);N(q,x.f+h/2,.66*g,.3*g,"arial","#fff",U-T+" / "+aa+" sets");fa&&(k=Math.round(1E4/(ha-fa)),q.fillStyle="#539",z(q,x.f+.8*h,.4*g,.2*h,.4*g),N(q,x.f+.9*h,.5*g,.2*g,"monospace","#fff",k+" fps"));k=.4*h;var n=g/20;h=x.f+.3*h;g-=(.15*g-n)/2;q.fillStyle="#988";z(q,h,g,k,n,n/2);q.fillStyle="#fff";z(q,h,g,Math.max(0,90-((D?ea:V)-Z-S)/1E3)/90*k,n,n/2);t.b(q,p.width,p.height);K.b(q,p.width,p.height);M.b(q,p.width,p.height)};(function(){v();u.addEventListener("resize",
v);var g=!1,h=!1;F.addEventListener("visibilitychange",function(){F.hidden?(D||(e(),g=!0),P&&(c(),h=!0)):(D&&g&&e(),!P&&h&&c(),h=g=!1)});F.addEventListener("keyup",function(k){m||(m=new la);"Escape"!==k.key||!I||M.j||K.j||(e(),t.D())});F.addEventListener("click",function(k){m||(m=new la);ia([W,x,t,K,M],(k.clientX-(u.innerWidth-E)/2)/E*p.width,k.clientY/H*p.height)});W=new w(r,"Menu",function(){e();t.D()});W.i();t.a(new w(r,"New Game",function(){a();t.u();d([400,600,900,1350,900,600,400],.5,.1)}));
t.a(new w(r,"Disable Sound Effects",function(k){"Disable Sound Effects"===k.text?(da=!1,k.text="Enable Sound Effects"):(da=!0,k.text="Disable Sound Effects",d([800,1200,1600],.5,.1))}));ba=t.a(new w(r,"Enable Music",c));t.a(new w(r,"Resolution: 1X",function(k){L*=2;4<L&&(L=.25);v();k.text="Resolution: "+L+"X"}));Y=t.a(new w(r,"Cancel",function(){e();t.u()}));K.a(new w(r,"New Game",function(){a();K.u();d([400,600,900,1350,900,600,400],.5,.1)}));ma=M.a(new w(r,"Start Next Level",function(){M.u();b()}));
l();Y.u();t.c("Combo Shapes");t.B()})()};F.getElementById("game-canvas").addEventListener("click",function(){F.getElementById("game-description").style.display="none"})})(window,document,void 0);
