'use strict';(function(r,E,ja){function u(){this.j=!0;this.F=this.J=this.I=this.A=this.o=this.m=this.h=this.f=0;this.L=Date.now();this.C=0}function w(a,b){u.call(this,a);this.title=b;this.buttons=[];this.j=!1}function t(a,b,c){u.call(this,a);this.text=b;this.g=c;this.c="#fff";this.a="#539"}function x(a){u.call(this,a);this.a=[];this.c={};this.b=[]}function y(a){u.call(this,a);this.b=3*Math.random()>>0;this.g=3*Math.random()>>0;this.a=3*Math.random()>>0;this.c=3*Math.random()>>0;this.s=0;this.i=!1}
const K=(a,b)=>{function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a},ba=(a,b,c)=>{for(let d=a.length-1;0<=d;d--)if(a[d].j&&a[d].K(b,c))return a[d].click(b,c),!0;return!1},F=(a,b,c,d)=>{a.beginPath();a.arc(b,c,d,0,2*Math.PI);a.fill()},v=(a,b,c,d,f,e)=>{d&&f&&((e=e||0)?(a.beginPath(),a.moveTo(b+e,c),a.lineTo(b+d-e,c),a.quadraticCurveTo(b+d,c,b+d,c+e),a.lineTo(b+d,c+f-e),a.quadraticCurveTo(b+d,c+f,b+d-e,c+f),a.lineTo(b+e,c+f),a.quadraticCurveTo(b,c+f,b,c+f-e),a.lineTo(b,
c+e),a.quadraticCurveTo(b,c,b+e,c),a.closePath(),a.fill()):a.fillRect(b,c,d,f))},G=(a,b,c,d,f,e,h)=>{a.save();a.fillStyle=e;a.font=d+"px "+f;a.textAlign="center";a.textBaseline="top";a.fillText(h,b,c-d/2);a.restore()};u.prototype={v:function(a,b,c,d){this.f=a;this.h=b;this.m=c;this.o=d},N:function(){const a=Date.now(),b=(a-this.C)/1E3;this.f+=this.I*b;this.h+=this.J*b;this.A+=this.F*b;this.C=a},M:function(a){return a.f+a.m>this.f&&a.h+a.o>this.h&&a.f<this.f+this.m&&a.h<this.h+this.o},K:function(a,
b){return a>=this.f&&a<this.f+this.m&&b>=this.h&&b<this.h+this.o},B:function(){this.j=!0},u:function(){this.j=!1},D:function(a){this.j=a!==ja?!!a:!this.j}};K(w,u);w.prototype.c=function(a){this.title=a};w.prototype.a=function(a){this.buttons.push(a);return a};w.prototype.b=function(a,b,c){if(this.j){this.v(0,0,b,c);a.fillStyle="rgba(0,0,0,0.8)";a.fillRect(0,0,b,c);var d=this.buttons.length+1,f=.8*b,e=Math.min(.1*c,.7*c/d),h=.3*e;d=d*e+(d-1)*h;b=b/2-f/2;G(a,b+f/2,c/2-d/2+e/2,.66*e,"helvetica,arial",
"#fff",this.title);for(let m=0;m<this.buttons.length;m++)this.buttons[m].b(a,b,c/2-d/2+(m+1)*(e+h),f,e)}};w.prototype.click=function(a,b){ba(this.buttons,a,b)};K(t,u);t.prototype.i=function(){this.c="#fff";this.a="#988"};t.prototype.b=function(a,b,c,d,f){this.j&&(this.v(b,c,d,f),a.fillStyle=this.a,v(a,b,c,d,f,f/10),G(a,b+d/2,c+f/2,.4*f,"helvetica, arial",this.c,this.text))};t.prototype.click=function(){this.g(this)};K(x,u);x.prototype.g=function(){for(let a=0;a<this.a.length;a++)this.a[a].G();this.b=
this.a;this.a=[];this.c={}};x.prototype.l=function(a){let b=[];for(var c=0;16>c;c++)(!this.a[c]||a&&this.a[c].i)&&b.push(c);do for(a=0;a<b.length;a++){c=b[a];this.a[c]&&(this.c[this.a[c].H()]=!1);let d=!1;for(;!d;){const f=new y(L),e=f.H();this.c[e]||(this.a[c]=f,d=this.c[e]=!0)}}while(!this.w())};x.prototype.w=function(){for(let a=0;a<this.a.length;a++)for(let b=0;b<this.a.length;b++)if(b!==a)for(let c=0;c<this.a.length;c++)if(c!==a&&c!==b&&this.i(this.a[a],this.a[b],this.a[c]))return!0;return!1};
x.prototype.i=function(a,b,c){return(a.b===b.b&&b.b===c.b||a.b!==b.b&&b.b!==c.b&&a.b!==c.b)&&(a.g===b.g&&b.g===c.g||a.g!==b.g&&b.g!==c.g&&a.g!==c.g)&&(a.a===b.a&&b.a===c.a||a.a!==b.a&&b.a!==c.a&&a.a!==c.a)&&(a.c===b.c&&b.c===c.c||a.c!==b.c&&b.c!==c.c&&a.c!==c.c)?!0:!1};x.prototype.s=function(a,b,c,d,f){this.v(b,c,d,f);a.fillStyle="#988";v(a,b,c,d,f,10);var e=d/20;F(a,b+e/2,c+e/2,e);F(a,b+d-e/2,c+e/2,e);F(a,b+e/2,c+f-e/2,e);F(a,b+d-e/2,c+f-e/2,e);let h;d/f>Q?(h=.2*f,e=h*Q):(e=.2*d,h=e/Q);const m=(d-
4*e)/2/3;d=(d-4*e-3*m)/2;f=(f-4*h-3*m)/2;for(let p=0;p<this.a.length;p++)this.a[p].v(b+d+p%4*(e+m),c+f+(p/4>>0)*(h+m),e,h),this.a[p].w(a);for(b=this.b.length-1;0<=b;b--)this.b[b].N(),this.b[b].w(a),this.M(this.b[b])||this.b.splice(b,1)};x.prototype.click=function(a,b){var c=!1;for(let d=this.a.length-1;0<=d;d--)c=this.a[d].click(a,b)||c;a=[];for(b=0;b<this.a.length;b++)this.a[b].i&&a.push(this.a[b]);if(3===a.length)if(this.i(a[0],a[1],a[2]))if(L.b())this.g();else{for(c=0;c<a.length;c++)a[c].G();this.b=
a;this.l(!0)}else{for(c=0;c<a.length;c++)a[c].i=!1;L.f()}else c&&L.c(800,1)};K(y,u);const ca=["#90f","#f70","#07f"];y.prototype.H=function(){return""+this.b+this.g+this.a+this.c};y.prototype.G=function(){this.C=Date.now();const a=15*this.m,b=Math.random()*Math.PI*2;this.I=Math.sin(b)*a;this.J=Math.cos(b)*a;this.F=6*Math.PI};y.prototype.w=function(a){var b=this.f;let c=this.h;const d=this.m,f=this.o;var e=(Date.now()-this.L)%1E3;this.s=(500<e?1E3-e:e)/500;a.save();this.A&&(a.translate(b+d/2,c+f/2),
a.rotate(this.A),b-=b+d/2,c-=c+f/2);e=d/20;if(this.i){a.fillStyle="#ee0";let h=d/20;v(a,b-h,c-h,d+2*h,f+2*h,e);a.fillStyle="#fa0";h=this.s*d/20;v(a,b-h,c-h,d+2*h,f+2*h,e)}a.fillStyle="#fff";v(a,b,c,d,f,e);e=.22*f;b=b+d/2-e/2;0===this.c?this.l(a,b,c+.5*f-e/2,e,e):1===this.c?(this.l(a,b,c+.33*f-e/2,e,e),this.l(a,b,c+.66*f-e/2,e,e)):(this.l(a,b,c+.2*f-e/2,e,e),this.l(a,b,c+.5*f-e/2,e,e),this.l(a,b,c+.8*f-e/2,e,e));a.restore()};y.prototype.l=function(a,b,c,d,f){a.save();0===this.a?(a.fillStyle=ca[this.b],
a.strokeStyle="none"):(1===this.a?(a.fillStyle="none",a.lineWidth=d/15):(a.fillStyle="none",a.lineWidth=d/4),a.strokeStyle=ca[this.b],b+=a.lineWidth/2,c+=a.lineWidth/2,d-=a.lineWidth,f-=a.lineWidth);if(0===this.g){var e=[[b,c],[b+.25*d,c],[b+.5*d,c],[b+.75*d,c],[b+d,c],[b+d,c+.25*f],[b+d,c+.5*f],[b+d,c+.75*f],[b+d,c+f],[b+.75*d,c+f],[b+.5*d,c+f],[b+.25*d,c+f],[b,c+f],[b,c+.75*f],[b,c+.5*f],[b,c+.25*f]];a.beginPath();c=.05*d;d=e[0][0];f=e[0][1];d=d+Math.random()*c*2-c;f=f+Math.random()*c*2-c;a.moveTo(d,
f);for(b=1;b<e.length;b++)d=e[b][0],f=e[b][1],d=d+Math.random()*c*2-c,f=f+Math.random()*c*2-c,a.lineTo(d,f);a.closePath();0===this.a?a.fill():a.stroke()}else 1===this.g?(e=d/2*(.9+.2*this.s),0===this.a?F(a,b+d/2,c+f/2,e):(d=b+d/2,c+=f/2,a.beginPath(),a.arc(d,c,e,0,2*Math.PI),a.stroke())):(a.translate(b+d/2,c+f/2),a.rotate(this.s*Math.PI/8-Math.PI/16),a.beginPath(),a.moveTo(0,-f/2),a.lineTo(d/2,f/2),a.lineTo(-d/2,f/2),a.closePath(),0===this.a?a.fill():a.stroke());a.restore()};y.prototype.click=function(a,
b){return a>=this.f&&a<this.f+this.m&&b>=this.h&&b<this.h+this.o?(this.i=!this.i,!0):!1};const Q=5/7,L=new function(){const a=E.getElementById("game-canvas"),b=a.getContext("2d"),c=r.AudioContext||r.webkitAudioContext;let d,f,e=1,h,m;const p=new x(this),q=new w(this,""),z=new w(this,"You Lose."),A=new w(this,"You Won!");let R,da,M,B=0,S,T,N=0,C=!1,ea=0,D,U,V,O=0,P=0,W=0,X=!0;const Y=()=>{.1>Math.abs(r.innerWidth/r.innerHeight-.625)?(d=r.innerWidth,f=r.innerHeight):.625<r.innerWidth/r.innerHeight?
(f=r.innerHeight,d=.625*f):(d=r.innerWidth,f=d/.625);a.style.width=d+"px";a.style.height=f+"px";a.width=d*e;a.height=f*e},fa=()=>{D=Date.now();0===ea%10&&(V=U,U=D);!C&&9E4<D-S-N&&(H(),p.g(),z.B(),Z(100,2));this.a();ea++;r.requestAnimationFrame(fa)},H=()=>{C?(N+=D-T,C=!1):(T=D,C=!0)},Z=(g,k)=>{if(X&&h){k=k||.5;var l=h.createOscillator(),n=h.createGain();l.connect(n);n.connect(h.destination);l.frequency.value=g;l.type="triangle";l.start(0);n.gain.value=.01;n.gain.exponentialRampToValueAtTime(1,h.currentTime+
.05);n.gain.exponentialRampToValueAtTime(1E-5,h.currentTime+k);l.stop(h.currentTime+2*k)}};this.c=Z;const J=(g,k,l)=>{let n=0;const I=()=>{Z(g[n],k);n++;n<g.length&&setTimeout(I,1E3*l)};I()};this.b=()=>{O++;J([800,1200,1600],.5,.1);return O-P>=W?(H(),da.text="Start Level "+(B+1),A.B(),!0):!1};this.f=()=>{P++;J([900,600,400],.5,.1)};this.a=()=>{b.save();b.fillStyle="#539";b.fillRect(0,0,a.width,a.height);b.restore();var g=.1*a.height,k=a.width,l=a.height-g;.75<k/l?(l*=.94,k=.75*l):(k*=.94,l=k/.75);
p.s(b,(a.width-k)/2,(a.height-l+g)/2,k,l);M.b(b,p.f,.25*g,.2*k,.5*g);b.fillStyle="#988";v(b,p.f+.3*k,.15*g,.4*k,.7*g,.07*g);G(b,p.f+k/2,.33*g,.2*g,"arial","#fff","Level "+B);G(b,p.f+k/2,.66*g,.3*g,"arial","#fff",O-P+" / "+W+" sets");V&&(l=Math.round(1E4/(U-V)),b.fillStyle="#539",v(b,p.f+.8*k,.4*g,.2*k,.4*g),G(b,p.f+.9*k,.5*g,.2*g,"monospace","#fff",l+" fps"));l=.4*k;const n=g/20;k=p.f+.3*k;g-=(.15*g-n)/2;b.fillStyle="#988";v(b,k,g,l,n,n/2);b.fillStyle="#fff";v(b,k,g,Math.max(0,90-((C?T:D)-S-N)/1E3)/
90*l,n,n/2);q.b(b,a.width,a.height);z.b(b,a.width,a.height);A.b(b,a.width,a.height)};const ha=()=>{B++;S=Date.now();N=0;C=!1;P=O=0;W=B;p.g();p.l()},ia=()=>{B=0;R.B();q.c("Game Paused");ha()};(()=>{Y();r.addEventListener("resize",Y);E.addEventListener("keyup",g=>{h||(h=new c);"Escape"!==g.key||!B||A.j||z.j||(H(),q.D())});E.addEventListener("click",g=>{h||(h=new c);ba([M,p,q,z,A],(g.clientX-(r.innerWidth-d)/2)/d*a.width,g.clientY/f*a.height)});M=new t(this,"Menu",()=>{H();q.D()});M.i();q.a(new t(this,
"New Game",()=>{ia();q.u();J([400,600,900,1350,900,600,400],.5,.1)}));q.a(new t(this,"Disable Sound Effects",g=>{"Disable Sound Effects"===g.text?(X=!1,g.text="Enable Sound Effects"):(X=!0,g.text="Disable Sound Effects",J([800,1200,1600],.5,.1))}));q.a(new t(this,"Enable Music",g=>{if("Disable Music"===g.text)g.text="Enable Music",m.gain.exponentialRampToValueAtTime(.2,h.currentTime),m.gain.exponentialRampToValueAtTime(1E-5,h.currentTime+.05);else if(g.text="Disable Music",m)m.gain.exponentialRampToValueAtTime(.2,
h.currentTime+.05);else if(h){g=h.createOscillator();m=h.createGain();g.connect(m);m.connect(h.destination);g.type="triangle";m.gain.value=.01;g.start(0);m.gain.exponentialRampToValueAtTime(.2,h.currentTime+.05);for(var k=[200,250,300,400],l=[.5,.25],n=0,I;3600>n;){const aa=k[Math.random()*k.length>>0];if(aa===I)continue;I=aa;const ka=l[Math.random()*l.length>>0];g.frequency.setValueAtTime(aa,h.currentTime+n);n+=ka}m.gain.setValueAtTime(.2,h.currentTime+n);m.gain.exponentialRampToValueAtTime(1E-5,
h.currentTime+n+1)}}));q.a(new t(this,"Resolution: 1X",g=>{e*=2;4<e&&(e=.25);Y();g.text="Resolution: "+e+"X"}));R=q.a(new t(this,"Cancel",()=>{H();q.u()}));z.a(new t(this,"New Game",()=>{ia();z.u();J([400,600,900,1350,900,600,400],.5,.1)}));da=A.a(new t(this,"Start Next Level",()=>{A.u();ha()}));fa();R.u();q.c("Combo Shapes");q.B()})()};E.getElementById("game-canvas").addEventListener("click",()=>{E.getElementById("game-description").style.display="none"})})(window,document,void 0);
