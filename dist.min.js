(function(v,F,oa){function N(a,b,c,e,f,d,l){a.save();a.fillStyle=d;a.font=e+"px "+f;a.textAlign="center";a.textBaseline="top";a.fillText(l,b,c-e/2);a.restore()}function z(a,b,c,e,f,d){e&&f&&((d=d||0)?(a.beginPath(),a.moveTo(b+d,c),a.lineTo(b+e-d,c),a.quadraticCurveTo(b+e,c,b+e,c+d),a.lineTo(b+e,c+f-d),a.quadraticCurveTo(b+e,c+f,b+e-d,c+f),a.lineTo(b+d,c+f),a.quadraticCurveTo(b,c+f,b,c+f-d),a.lineTo(b,c+d),a.quadraticCurveTo(b,c,b+d,c),a.closePath(),a.fill()):a.fillRect(b,c,e,f))}function O(a,b,c,
e){a.beginPath();a.arc(b,c,e,0,2*Math.PI);a.fill()}function ja(a,b,c){for(var e=a.length-1;0<=e;e--)if(a[e].j&&a[e].L(b,c))return a[e].click(b,c),!0;return!1}function R(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a}function A(){this.j=!0;this.G=this.K=this.J=this.A=this.u=this.o=this.h=this.f=0;this.M=Date.now();this.C=0}function B(a,b){A.call(this,a);this.title=b;this.buttons=[];this.j=!1}function w(a,b,c){A.call(this,a);this.text=b;this.g=c;this.c="#fff";
this.a="#539"}function C(a){A.call(this,a);this.a=[];this.c={};this.b=[]}function G(a){A.call(this,a);this.c=3*Math.random()>>0;this.b=3*Math.random()>>0;this.a=3*Math.random()>>0;this.g=3*Math.random()>>0;this.s=0;this.i=!1;this.m=[];if(0===this.b)for(a=0;a<P.length;a++)this.m.push([0,0])}A.prototype={w:function(a,b,c,e){this.f=a;this.h=b;this.o=c;this.u=e},O:function(){var a=Date.now(),b=(a-this.C)/1E3;this.f+=this.J*b;this.h+=this.K*b;this.A+=this.G*b;this.C=a},N:function(a){return a.f+a.o>this.f&&
a.h+a.u>this.h&&a.f<this.f+this.o&&a.h<this.h+this.u},L:function(a,b){return a>=this.f&&a<this.f+this.o&&b>=this.h&&b<this.h+this.u},B:function(){this.j=!0},v:function(){this.j=!1},F:function(a){this.j=a!==oa?!!a:!this.j}};R(B,A);B.prototype.c=function(a){this.title=a};B.prototype.a=function(a){this.buttons.push(a);return a};B.prototype.b=function(a,b,c){if(this.j){this.w(0,0,b,c);a.fillStyle="rgba(0,0,0,0.8)";a.fillRect(0,0,b,c);var e=this.buttons.length+1,f=.8*b,d=Math.min(.1*c,.7*c/e),l=.3*d;e=
e*d+(e-1)*l;b=b/2-f/2;N(a,b+f/2,c/2-e/2+d/2,.66*d,"helvetica,arial","#fff",this.title);for(var m=0;m<this.buttons.length;m++)this.buttons[m].b(a,b,c/2-e/2+(m+1)*(d+l),f,d)}};B.prototype.click=function(a,b){ja(this.buttons,a,b)};R(w,A);w.prototype.i=function(){this.c="#fff";this.a="#988"};w.prototype.b=function(a,b,c,e,f){this.j&&(this.w(b,c,e,f),a.fillStyle=this.a,z(a,b,c,e,f,f/10),N(a,b+e/2,c+f/2,.4*f,"helvetica, arial",this.c,this.text))};w.prototype.click=function(){this.g(this)};R(C,A);C.prototype.g=
function(){for(var a=0;a<this.a.length;a++)this.a[a].H();this.b=this.a;this.a=[];this.c={}};C.prototype.l=function(a){for(var b=[],c=0;16>c;c++)(!this.a[c]||a&&this.a[c].i)&&b.push(c);do for(a=0;a<b.length;a++){c=b[a];this.a[c]&&(this.c[this.a[c].I()]=!1);for(var e=!1;!e;){var f=new G(S),d=f.I();this.c[d]||(this.a[c]=f,e=this.c[d]=!0)}}while(!this.s())};C.prototype.s=function(){for(var a=0;a<this.a.length;a++)for(var b=0;b<this.a.length;b++)if(b!==a)for(var c=0;c<this.a.length;c++)if(c!==a&&c!==b&&
this.i(this.a[a],this.a[b],this.a[c]))return!0;return!1};C.prototype.i=function(a,b,c){return(a.c===b.c&&b.c===c.c||a.c!==b.c&&b.c!==c.c&&a.c!==c.c)&&(a.b===b.b&&b.b===c.b||a.b!==b.b&&b.b!==c.b&&a.b!==c.b)&&(a.a===b.a&&b.a===c.a||a.a!==b.a&&b.a!==c.a&&a.a!==c.a)&&(a.g===b.g&&b.g===c.g||a.g!==b.g&&b.g!==c.g&&a.g!==c.g)?!0:!1};C.prototype.m=function(a,b,c,e,f){this.w(b,c,e,f);a.fillStyle="#988";z(a,b,c,e,f,10);var d=e/20;O(a,b+d/2,c+d/2,d);O(a,b+e-d/2,c+d/2,d);O(a,b+d/2,c+f-d/2,d);O(a,b+e-d/2,c+f-d/
2,d);if(e/f>Y){var l=.2*f;d=l*Y}else d=.2*e,l=d/Y;var m=(e-4*d)/2/3;e=(e-4*d-3*m)/2;f=(f-4*l-3*m)/2;for(var t=0;t<this.a.length;t++)this.a[t].w(b+e+t%4*(d+m),c+f+(t/4>>0)*(l+m),d,l),this.a[t].D(a);for(b=this.b.length-1;0<=b;b--)this.b[b].O(),this.b[b].D(a),this.N(this.b[b])||this.b.splice(b,1)};C.prototype.click=function(a,b){for(var c=!1,e=this.a.length-1;0<=e;e--)c=this.a[e].click(a,b)||c;a=[];for(b=0;b<this.a.length;b++)this.a[b].i&&a.push(this.a[b]);if(3===a.length)if(this.i(a[0],a[1],a[2]))if(S.b())this.g();
else{for(c=0;c<a.length;c++)a[c].H();this.b=a;this.l(!0)}else{for(c=0;c<a.length;c++)a[c].i=!1;S.f()}else c&&S.c(800,1)};var P=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]];R(G,A);var ka=["#90f","#f70","#07f"];G.prototype.I=function(){return""+this.c+this.b+this.a+this.g};G.prototype.H=function(){this.C=Date.now();var a=15*this.o,b=Math.random()*Math.PI*2;this.J=Math.sin(b)*a;this.K=Math.cos(b)*a;this.G=6*Math.PI};G.prototype.D=function(a){var b=this.f,c=this.h,e=this.o,f=this.u,d=(Date.now()-
this.M)%1E3;this.s=(500<d?1E3-d:d)/500;a.save();this.A&&(a.translate(b+e/2,c+f/2),a.rotate(this.A),b-=b+e/2,c-=c+f/2);d=e/20;if(this.i){a.fillStyle="#ee0";var l=e/20;z(a,b-l,c-l,e+2*l,f+2*l,d);a.fillStyle="#fa0";l=this.s*e/20;z(a,b-l,c-l,e+2*l,f+2*l,d)}a.fillStyle="#fff";z(a,b,c,e,f,d);if(0===this.b){d=this.m;l=.01*e;for(var m=0;m<d.length;m++)d[m][0]+=Math.random()*l/2*2-l/2,d[m][1]+=Math.random()*l/2*2-l/2,d[m][0]=Math.min(P[m][0]+l,Math.max(P[m][0]-l,d[m][0])),d[m][1]=Math.min(P[m][1]+l,Math.max(P[m][1]-
l,d[m][1]));this.m=d}d=.22*f;b=b+e/2-d/2;0===this.g?this.l(a,b,c+.5*f-d/2,d,d):1===this.g?(this.l(a,b,c+.33*f-d/2,d,d),this.l(a,b,c+.66*f-d/2,d,d)):(this.l(a,b,c+.2*f-d/2,d,d),this.l(a,b,c+.5*f-d/2,d,d),this.l(a,b,c+.8*f-d/2,d,d));a.restore()};G.prototype.l=function(a,b,c,e,f){a.save();0===this.a?(a.fillStyle=ka[this.c],a.strokeStyle="none"):(1===this.a?(a.fillStyle="none",a.lineWidth=e/15):(a.fillStyle="none",a.lineWidth=e/4),a.strokeStyle=ka[this.c],b+=a.lineWidth/2,c+=a.lineWidth/2,e-=a.lineWidth,
f-=a.lineWidth);if(0===this.b){var d=[[b,c],[b+.5*e,c],[b+e,c],[b+e,c+.5*f],[b+e,c+f],[b+.5*e,c+f],[b,c+f],[b,c+.5*f]];for(c=0;c<this.m.length;c++)d[c][0]+=this.m[c][0],d[c][1]+=this.m[c][1];a.beginPath();a.moveTo(d[0][0],d[0][1]);for(c=1;c<d.length;c++)a.lineTo(d[c][0],d[c][1]);a.closePath();0===this.a?a.fill():a.stroke()}else 1===this.b?(d=e/2*(.9+.2*this.s),0===this.a?O(a,b+e/2,c+f/2,d):(b+=e/2,c+=f/2,a.beginPath(),a.arc(b,c,d,0,2*Math.PI),a.stroke())):(a.translate(b+e/2,c+f/2),a.rotate(this.s*
Math.PI/8-Math.PI/16),a.beginPath(),a.moveTo(0,-f/2),a.lineTo(e/2,f/2),a.lineTo(-e/2,f/2),a.closePath(),0===this.a?a.fill():a.stroke());a.restore()};G.prototype.click=function(a,b){return a>=this.f&&a<this.f+this.o&&b>=this.h&&b<this.h+this.u?(this.i=!this.i,!0):!1};var Y=5/7,S=new function(){function a(){I=0;Z.B();u.c("Game Paused");b()}function b(){I++;aa=Date.now();T=0;D=!1;U=V=0;ba=I;x.g();x.l()}function c(){if(Q)Q=!1,ca.text="Enable Music",y.gain.exponentialRampToValueAtTime(.2,n.currentTime),
y.gain.exponentialRampToValueAtTime(1E-5,n.currentTime+.05);else if(Q=!0,ca.text="Disable Music",y)y.gain.exponentialRampToValueAtTime(.2,n.currentTime+.05);else if(n){var g=n.createOscillator();y=n.createGain();g.connect(y);y.connect(n.destination);g.type="triangle";y.gain.value=.01;g.start(0);y.gain.exponentialRampToValueAtTime(.2,n.currentTime+.05);for(var h=[200,250,300,400],k=[.5,.25],p=0,J;3600>p;){var da=h[Math.random()*h.length>>0];if(da!==J){J=da;var pa=k[Math.random()*k.length>>0];g.frequency.setValueAtTime(da,
n.currentTime+p);p+=pa}}y.gain.setValueAtTime(.2,n.currentTime+p);y.gain.exponentialRampToValueAtTime(1E-5,n.currentTime+p+1)}}function e(g,h,k){function p(){f(g[J],h);J++;J<g.length&&setTimeout(p,1E3*k)}var J=0;p()}function f(g,h){if(ea&&n){h=h||.5;var k=n.createOscillator(),p=n.createGain();k.connect(p);p.connect(n.destination);k.frequency.value=g;k.type="triangle";k.start(0);p.gain.value=.01;p.gain.exponentialRampToValueAtTime(1,n.currentTime+.05);p.gain.exponentialRampToValueAtTime(1E-5,n.currentTime+
h);k.stop(n.currentTime+2*h)}}function d(){D?(T+=Date.now()-fa,D=!1):(fa=Date.now(),D=!0)}function l(){W=Date.now();0===la%10&&(ha=ia,ia=W);!D&&9E4<W-aa-T&&(d(),x.g(),K.B(),f(100,2));t.a();la++;v.requestAnimationFrame(l)}function m(){.1>Math.abs(v.innerWidth/v.innerHeight-.625)?(E=v.innerWidth,H=v.innerHeight):.625<v.innerWidth/v.innerHeight?(H=v.innerHeight,E=.625*H):(E=v.innerWidth,H=E/.625);q.style.width=E+"px";q.style.height=H+"px";q.width=E*L;q.height=H*L}var t=this,q=F.getElementById("game-canvas"),
r=q.getContext("2d"),ma=v.AudioContext||v.webkitAudioContext,E,H,L=1,n,y,x=new C(this),u=new B(this,""),K=new B(this,"You Lose."),M=new B(this,"You Won!"),ca,Z,na,X,I=0,aa,fa,T=0,D=!1,la=0,W,ia,ha,V=0,U=0,ba=0,ea=!0,Q=!1;this.c=f;this.b=function(){V++;e([800,1200,1600],.5,.1);return V-U>=ba?(d(),na.text="Start Level "+(I+1),M.B(),!0):!1};this.f=function(){U++;e([900,600,400],.5,.1)};this.a=function(){r.save();r.fillStyle="#539";r.fillRect(0,0,q.width,q.height);r.restore();var g=.1*q.height,h=q.width,
k=q.height-g;.75<h/k?(k*=.94,h=.75*k):(h*=.94,k=h/.75);x.m(r,(q.width-h)/2,(q.height-k+g)/2,h,k);X.b(r,x.f,.25*g,.2*h,.5*g);r.fillStyle="#988";z(r,x.f+.3*h,.15*g,.4*h,.7*g,.07*g);N(r,x.f+h/2,.33*g,.2*g,"arial","#fff","Level "+I);N(r,x.f+h/2,.66*g,.3*g,"arial","#fff",V-U+" / "+ba+" sets");ha&&(k=Math.round(1E4/(ia-ha)),r.fillStyle="#539",z(r,x.f+.8*h,.4*g,.2*h,.4*g),N(r,x.f+.9*h,.5*g,.2*g,"monospace","#fff",k+" fps"));k=.4*h;var p=g/20;h=x.f+.3*h;g-=(.15*g-p)/2;r.fillStyle="#988";z(r,h,g,k,p,p/2);
r.fillStyle="#fff";z(r,h,g,Math.max(0,90-((D?fa:W)-aa-T)/1E3)/90*k,p,p/2);u.b(r,q.width,q.height);K.b(r,q.width,q.height);M.b(r,q.width,q.height)};(function(){m();v.addEventListener("resize",m);var g=!1,h=!1;F.addEventListener("visibilitychange",function(){F.hidden?(D||(d(),g=!0),Q&&(c(),h=!0)):(D&&g&&d(),!Q&&h&&c(),h=g=!1)});F.addEventListener("keyup",function(k){n||(n=new ma);"Escape"!==k.key||!I||M.j||K.j||(d(),u.F())});F.addEventListener("click",function(k){n||(n=new ma);ja([X,x,u,K,M],(k.clientX-
(v.innerWidth-E)/2)/E*q.width,k.clientY/H*q.height)});X=new w(t,"Menu",function(){d();u.F()});X.i();u.a(new w(t,"New Game",function(){a();u.v();e([400,600,900,1350,900,600,400],.5,.1)}));u.a(new w(t,"Disable Sound Effects",function(k){"Disable Sound Effects"===k.text?(ea=!1,k.text="Enable Sound Effects"):(ea=!0,k.text="Disable Sound Effects",e([800,1200,1600],.5,.1))}));ca=u.a(new w(t,"Enable Music",c));u.a(new w(t,"Resolution: 1X",function(k){L*=2;4<L&&(L=.25);m();k.text="Resolution: "+L+"X"}));
Z=u.a(new w(t,"Cancel",function(){d();u.v()}));K.a(new w(t,"New Game",function(){a();K.v();e([400,600,900,1350,900,600,400],.5,.1)}));na=M.a(new w(t,"Start Next Level",function(){M.v();b()}));l();Z.v();u.c("Combo Shapes");u.B()})()};F.getElementById("game-canvas").addEventListener("click",function(){F.getElementById("game-description").style.display="none"})})(window,document,void 0);
